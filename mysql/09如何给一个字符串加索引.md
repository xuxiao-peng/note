由于字符串的长度是不固定的，索引给字符串加索引的时候，不可避免的要考虑字符串的长度。如果一个字符串的长度很长，那么我们该怎么选择索引呢？



# 前缀索引

定义字符串的一部分作为索引 

默认地，如果你创建索引的语句不指定前缀长度，那么索引就会包含整个字符串 

```sql
alter table SUser add index index2(email(6)); // 创建前缀索引的语法，在这里是选择 email 的前6个字符作为索引
```

## 和普通索引的区别

![普通字符串索引](img\普通字符串索引.png)



![前缀字符串索引](C:\Users\P\Desktop\笔记本\mysql\img\前缀字符串索引.png)

### 优点

从图中你可以看到，由于 email(6) 这个索引结构中每个邮箱字段都只取前 6 个字节（即：zhangs），所以占用的空间会更小，这就是使用前缀索引的优势。

### 缺点

这同时带来的损失是，可能会增加额外的记录扫描次数 

### 总结

使用前缀索引，**定义好长度**，就可以做到既节省空间，又不用额外增加太多的查询成本。 

## 如何定义好长度

建立好区分度，区分度越高，重复的键越少。我们可以通过统计索引上有多少个不同的值来判断要使用多长的
前缀。 

```sql
select
count(distinct left(email,4)）as L4,
count(distinct left(email,5)）as L5,
count(distinct left(email,6)）as L6,
count(distinct left(email,7)）as L7,
from SUser;
```

当然，使用前缀索引很可能会损失区分度，所以你需要预先设定一个可以接受的损失比
例，比如 5%。然后，在返回的 L4~L7 中，找出不小于 L * 95% 的值，假设这里 L6、L7都满足，你就可以选择前缀长度为 6 

# 前缀索引对覆盖索引的影响 

使用前缀索引的时候还会对覆盖索引产生影响

```sql
select id,email from SUser where email='zhangssxyz@xxx.com';
```

如果是普通索引，那么直接根据 email 返回对于的 email 和 id 值，不需要回表查询

如果是前缀索引，还需要回表查询，看对应的 email是不是我查询的 email。

使用**前缀索引就用不上覆盖索引对查询性能的优化了**，这也是你在选择是否使用前缀索引时需要考虑的一个因素 

# 其他方式

## 第一种方式是使用倒序存储 

使用倒序存储，用来保证区分度。

## 第二种方式是使用 hash 字段 

给表再上一个hash字段，查询的时候根据 hash值来查询

