## 事务的四大特性（ACID）

- 原子性（atomicity）：原子性是指事务包含的所有操作要么全部成功，要么全部失败回滚

- 一致性（consistency）：一致性是指事务必须使数据库从一个一致性状态变换到另一个一致性状态，也就是说一个事务执行之前和执行之后都必须处于一致性状态。

- 隔离性（isolation）：隔离性是当多个用户并发访问数据库时，比如操作同一张表时，数据库为每一个用户开启的事务，不能被其他事务的操作所干扰，多个并发事务之间要相互隔离

- 持久性（durability）：一旦事务提交，则其所做的修改就会永久保存到数据库中。此时即使系统崩溃，修改的数据也不会丢失。

## 数据库事务的隔离

在介绍事务隔离之前我们先介绍我们隔离之后会发生什么后果？

### **（1）脏读**

所谓脏读就是指在事务在处理过程中，有另一事务读取了该数据


例如： 你妈妈给你打生活费 1000，开启事务，结果你妈不小心手一抖给你转了 1 W。你此时正好没钱，查数据看钱到账没。结果一看发现卡上有1万元，正在这时然而你妈机智的发现钱转多了，又回滚了操作。饿了两天的你准备到食堂大吃一顿，点餐付钱的时候缺发现余额不足，非常郁闷。

这里的主要问题：事务没有提交，然后却被其他事务读取数据
**解决方案**：开启  Read committed 
也就是说采用读提交方式，只要我没有提交事务，那么另外的事务就不能读取该数据

### **（2）不可重复读**

不可重复读是指在对于数据库中的某个数据，一个事务范围内多次查询却返回了不同的数据值，这是由于在查询间隔，被另一个事务修改并提交了。

我们开启了Read committed之后又会遇到另外的一个问题。

例如：小明骗妈妈说学校要交补课费，给小明了两千大洋。小明知道了这件事后准备去享受生活，当小明和女朋友去逛街买单前，查看账户有2100元（此时事务开启）。此时小明妈妈被小李妈妈提醒得知被骗了，于是乎把小明卡上的钱全部转到其他卡上去了。小明此时并不知情，付款时得知余额不足，在女朋友面前非常尴尬。

在这里我们的小明妈妈，并没有读取数据，而是直接修改卡上的钱，使之变为0。不称之为脏读，这里的主要问题是重复读取的问题

**解决方案**：Repeatable read
重复读，就是在开始读取数据（事务开启）时，不再允许修改操作

### **（3）幻读**

事例：程序员某一天去消费，花了2千元，然后他的妻子去查看他今天的消费记录（全表扫描FTS，妻子事务开启），看到确实是花了2千元，就在这个时候，程序员花了1万买了一部电脑，即新增INSERT了一条消费记录，并提交。当妻子打印程序员的消费记录清单时（妻子事务提交），发现花了1.2万元，似乎出现了幻觉，这就是幻读。

解决方案：Serializable 序列化

Serializable 是最高的事务隔离级别，在该级别下，事务串行化顺序执行，可以避免脏读、不可重复读与幻读。但是这种事务隔离级别效率低下，比较耗数据库性能，一般不使用。

## 事务隔离级别



上面我们提到的几种解决方案其实就是我们的四种事务隔离级别

从高到低依次是：

|             级别             | 解释                                                         | 作用                                                         |
| :--------------------------: | :----------------------------------------------------------- | ------------------------------------------------------------ |
|    Serializable（串行化）    | 顾名思义是对于同一行记录，“写”会加“写锁”，“读”会加“读锁”。当出现读写锁冲突的时候，后访问的事务必须等前一个事务执行完成，才能继续执行 | 可避免脏读、不可重复读、幻读的发生                           |
|  Repeatable read（重复读）   | 一个事务执行过程中看到的数据，总是跟这个事务在启动时看到的数据是一致的。当然在可重复读隔离级别下，未提交变更对其他事务也是不可见的 | 可避免脏读、不可重复读的发生                                 |
|  Read committed （读提交）   | 一个事务提交之后，它做的变更才会被其他事务看到               | 可避免脏读的发生                                             |
| Read uncommitted（读未提交） | 一个事务还没提交时，它做的变更就能被别的事务看到             | 一个事务还没提交时，它做的变更就能被别的事务看到 最。低级别，任何情况都无法保证 |

