# 1.IP即网际协议

IP( Internet Protocol )和 ICMP( Internet Control Message Protocol)共同组成了互联网层。

## 1.1 IP相当于OSI参考模型的网络层

网络层的主要作用是 “实现终端节点之间的通信”。也叫点对点通信（point-to-point）

# 2 IP基础知识

IP 大致分为三大作用模块

1. IP 寻址
2. 路由
3. IP 分包与组包

## 2.1 IP地址属于网络层地址

IP 地址用于 ”连接到网络中的所有主机中识别出进行通信的目标地址“，所有在 TCP\IP通信中**所有主机或路由器必须设定自己的IP地址**（严格来说，至少每块网卡要配一个或多个IP地址）。

## 2.2 路由控制

路由控制 是指**将分组数据发送到最终目标地址的功能** 

路由控制的这种功能是由 HOP(跳)来实现的，IP包在网络中一个跳间被转发。因此IP路由也叫**多跳路由**（路由器或主机在转发IP包时只指定下一个路由器或主机，而不是将到最终目标地址为止的所有通路全部指定出来。 **不知道这样做的好处**）



![4.5多跳路由](C:\Users\P\Desktop\笔记本\img\计算机网络\4.5多跳路由.png)



### 2.2.1 路由控制表

在 windows 中 使用命令 `Route All` 查看我们的路由表，该表记录IP数据在下一步应该发给哪个路由器。 IP 根据该路由表在各个数据链路上传输。

![1559130269033](C:\Users\P\Desktop\笔记本\img\计算机网络\4.8路由控制表.png)

## 2.3 IP属于面向无连接型

IP 在发包之前，**不需要建立与对端目标地址之间的链接**。上层如果遇到需要发送给 IP 的数据，该数据会立即被压缩成 IP 包发送出去。

相比于 TCP 面向连接的情况下，IP 可能会错过一些该收的包。因此，在面向无连接的方式下可能会有很多冗余的通信

### IP 采用无连接的原因

#### 一、为了简化

面向连接处理相对复杂，甚至管理每个连接本身就是一个相当繁琐的事情。

#### 二、为了提速

相比每次通信之前都要事先建立连接，会降低处理速度。需要连接时，可以委托上一层提供此项服务。（TCP）



### 注：为什么 不让IP具有可靠传输的功能，从而把这两种协议合并到一起呢？

![1559130770312](C:\Users\P\Desktop\笔记本\img\计算机网络\不把IP和TCP合并到一起的原因.png)

# 3 IP地址的基础知识

> 这个称呼的 IP 地址无特殊指明的话，指向IPv4

## 3.1 IP地址的定义

IP 地址 **32**位二进制数来表示，为了习惯人类社会的表现形式，把 32 位二进制数分为 8 位一组，分为 4 组，每组以 `.` 隔开，将每组的二进制数转换为十进制数。

![1559131232510](C:\Users\P\Desktop\笔记本\img\计算机网络\IP地址的转换.png)

因为每个设备原则上都是要有单独的一个 IP 地址的，而我们的 IP 地址 
$$
2^{32} = 4 296 967 296
$$
最多能分配近 43 亿台网络设备来进行分配，这明显是不够的（地球有 75.3 亿人口）。为了合理使用 IP 地址，这里引入了 IP 分类。

## 3.2 IP地址的组成

### 由那些组成

IP 地址由`网络地址`和`主机地址` 两部分组成。

网络地址 保证每一个相互连接的网段的地址不重复

主机地址 保证同一个网段内不允许重复出现

两者一起保证了 IP 地址的唯一性

## 3.3 如何进行分类？

### 一、传统分类

IP 地址传统分为四个级别，A 类、B 类、C 类、D 类。根据 IP 地址的 1~4 位的值进行区分

![1559132051782](C:\Users\P\Desktop\笔记本\img\计算机网络\IP地址传统分类（一）.png)

![1559132105234](C:\Users\P\Desktop\笔记本\img\计算机网络\IP地址传统分类（二）.png)

在这种分类的情况下 IP 地址会被很大的浪费，

在 A 类地址被分配后 可以分配给 1 千万台机器，因为只有128 个 A 类IP 所以一般不会被占用。

被分配的 IP 大多是 B 类 IP , B类可以分配6万多台计算机，只有一般的超大型公司才会有那么多人。

这种分配方式造成了极大的浪费，于是乎就发明了一种新的分类方式

### 二、子网与子网掩码

现在 IP 不在受限于A、B、C、D分类，由子网掩码在进行分类。

现在的规则为 IP 的 网络地址部分位全部为“1”，主机地址全部为“0”。

![1559132718916](C:\Users\P\Desktop\笔记本\img\计算机网络\子网掩码.png)

## 3.4 外网 IP 和内网 IP

因为在互联网中的主机必须有一个唯一 IP,而 IP 地址只有42亿个。虽然有子网掩码来进行分类，但随着互联网的迅速普及，IP 地址不足的问题也日趋显著，总有被耗尽的危险。于是就一种新的技术来**缓解这种危机**。它不要求每台主机或路由器都有一个固定的唯一 IP 地址，而是必要的时候对相应数量的设备进行分配相应的 IP 地址。这就引出了内网和外网的概念。

内网地址的网段

![1559133114248](C:\Users\P\Desktop\笔记本\img\计算机网络\内网地址的网段.png)

在这之外的网段都称为公网。

一个公网可以由多个不同的内网。

# 4 路由控制

## 4.1 IP 地址与路由控制

![1559133916162](C:\Users\P\Desktop\笔记本\img\计算机网络\路由控制表与IP包发送.png)

路由控制表记录着网络地址与下一步应该发送至路由器的地址。

### 发送步骤

发送IP包时，首先确认 IP包首部的目标地址，再从路由控制表中找到与该地址具有相同的网络地址记录，然后将该IP包转发到相应的路由器中。

### 路由分组

路由分为 默认路由、网络路由、主机路由

1，一个ip报文在路由器中寻路是通过报文的目的ip去匹配路由表。
2，路由表的键值简单地说包括ip和掩码n，1的匹配过程是最长路径匹配，也就是说报文优选掩码最长的路由。
3，主机路由就是x.x.x.x/32，意思是仅仅到x.x.x.x的报文听我的。
4，网络路由就是x.x.x.x/n,意思是到x.x.x.x/n的报文听我的。
5，默认路由是0.0.0.0/0，意思是实在没人要的报文听我的。

### 路由汇总

在路由表中，有很多的 IP 地址是用一个网段的，我们使用路由汇总技术，使同一个网段的 IP地址进行汇总，从而达到减少路由表的条目。





![1559136186035](C:\Users\P\Desktop\笔记本\img\计算机网络\理由汇总.png)

优点：

![1559136241579](C:\Users\P\Desktop\笔记本\img\计算机网络\路由汇总的优点.png)

